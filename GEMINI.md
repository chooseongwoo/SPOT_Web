# GEMINI.md

> 이 문서는 Gemini CLI가 프로젝트 작업을 수행할 때 반드시 참고해야 할 기본 원칙과 구조적 가이드를 정의합니다.

---

## 🧭 프로젝트 개요

본 프로젝트는 Supabase를 백엔드로 사용하며, 사용자 기반의 메시지와 타임캡슐 시스템을 중심으로 구성되어 있습니다. 각 기능은 보안, 사용자 권한, 구조적 일관성을 우선으로 설계되어 있습니다.

프론트엔드는 Next.js 기반으로 구성되어 있으며, API는 Supabase Client를 사용하여 직접 호출하는 방식입니다.

---

## ⚙️ 개발 원칙

- 기존 코드 흐름, 구조, 컨벤션을 **최우선으로 존중**할 것
- **기존 기능(User, History 등)**을 참고하여 동일한 구조와 패턴으로 확장할 것
- 불필요한 리팩토링, 재설계, 새로운 추상화 도입은 **지양**
- 기존 코드에서 사용 중인 라이브러리, 스타일 시스템, 유틸 함수 등을 우선 활용

---

## 📐 구조적 통일성

- **폴더 구조, 파일 위치, 네이밍**은 기존 컴포넌트들과 일관되게 유지
- 데이터 요청은 Supabase Client를 직접 사용하는 방식으로 통일
- 상태 관리는 Jotai 기반의 Atom 구조를 유지
- 공통 인터페이스, 모델, 타입은 중복 정의 없이 기존 타입에 통합

---

## 🔐 데이터베이스 및 보안

- Supabase의 테이블 스키마 및 RLS 정책은 이미 정의되어 있으며, 임의로 수정하거나 추가하지 말 것
- 데이터 관련 로직은 반드시 Supabase의 정책을 기반으로 작성할 것
- 인증된 사용자만 조작 가능한 데이터는 `auth.uid()` 기준의 제약을 준수

---

## 🎨 UI/UX

- 모든 디자인 요소는 현재 프로젝트의 스타일 시스템과 통일성을 유지해야 함
- 불필요한 새로운 스타일 도입을 피하고, 기존 컴포넌트(Button, Input 등) 재사용 우선
- 시각적 표현은 다른 페이지들과의 **자연스러운 통합**을 목표로 함

---

## 🚫 하지 말아야 할 것

- 새로운 외부 라이브러리 또는 디자인 시스템 도입
- 기존 스키마 수정, 새로운 테이블/필드 생성
- 불필요한 코드 리팩토링, 아키텍처 변경
- 기존 구조와 어울리지 않는 독립적 구현

---

## ✅ 핵심 목표

- 기존 코드에 잘 녹아드는 기능 추가
- 통일성 있는 구조와 인터페이스 유지
- Supabase와 현재 프로젝트 구조에 정확히 맞는 방식으로 개발

---

다음은 Supabase 구성 코드입니다.

```
create table if not exists public.users (
  id uuid primary key references auth.users(id) on delete cascade,
  nickname text not null unique,
  profile_image_url text not null,
  profile_complete boolean default false,
  created_at timestamp with time zone default now()
);

create table if not exists public.messages (
  id uuid primary key default uuid_generate_v4(),
  user_id uuid references public.users(id) on delete cascade,
  content text not null,
  lat float8 not null,
  lng float8 not null,
  is_time_capsule boolean default false,
  open_at timestamp with time zone,
  is_anonymous boolean default false,
  created_at timestamp with time zone default now(),
  image_url TEXT NOT NULL DEFAULT ''
);


create table if not exists public.message_views (
  id uuid primary key default uuid_generate_v4(),
  user_id uuid references public.users(id) on delete cascade,
  message_id uuid references public.messages(id) on delete cascade,
  viewed_at timestamp with time zone default now(),
  via_ar boolean default false
);

create table if not exists public.reactions (
  id bigint generated by default as identity primary key,
  created_at timestamptz not null default now(),
  user_id uuid not null references public.users(id) on delete cascade,
  message_id uuid not null references public.messages(id) on delete cascade,
  unique (user_id, message_id)
);

create table if not exists public.comments (
  id bigint generated by default as identity primary key,
  created_at timestamptz not null default now(),
  user_id uuid not null references public.users(id) on delete cascade,
  message_id uuid not null references public.messages(id) on delete cascade,
  content text not null check (char_length(content) > 0 and char_length(content) <= 500)
);

create table if not exists public.notices (
  id uuid primary key default uuid_generate_v4(),
  title text not null,
  content text not null,
  created_at timestamp with time zone default now()
);

alter table public.users enable row level security;

drop policy if exists "Select own user info" on public.users;
create policy "Select own user info" on public.users for select using (id = auth.uid());

drop policy if exists "Insert own user info" on public.users;
create policy "Insert own user info" on public.users for insert with check (id = auth.uid());

drop policy if exists "Update own user info" on public.users;
create policy "Update own user info" on public.users for update using (id = auth.uid());

drop policy if exists "Allow all users to read user profiles" on public.users;
create policy "Allow all users to read user profiles" on public.users for select using (true);

alter table public.messages enable row level security;

drop policy if exists "Select all messages" on public.messages;
create policy "Select all messages" on public.messages for select using (true);

drop policy if exists "Insert own messages" on public.messages;
create policy "Insert own messages" on public.messages for insert with check (user_id = auth.uid());

drop policy if exists "Update own messages" on public.messages;
create policy "Update own messages" on public.messages for update using (user_id = auth.uid());

drop policy if exists "Delete own messages" on public.messages;
create policy "Delete own messages" on public.messages for delete using (user_id = auth.uid());

alter table public.message_views enable row level security;

drop policy if exists "Select own message views" on public.message_views;
create policy "Select own message views" on public.message_views for select using (user_id = auth.uid());

drop policy if exists "Insert own message views" on public.message_views;
create policy "Insert own message views" on public.message_views for insert with check (user_id = auth.uid());

drop policy if exists "Delete own message views" on public.message_views;
create policy "Delete own message views" on public.message_views for delete using (user_id = auth.uid());

alter table public.reactions enable row level security;

drop policy if exists "Allow all users to read reactions" on public.reactions;
create policy "Allow all users to read reactions" on public.reactions for select using (true);

drop policy if exists "Allow authenticated users to insert their own reactions" on public.reactions;
create policy "Allow authenticated users to insert their own reactions" on public.reactions for insert with check (auth.uid() = user_id);

drop policy if exists "Allow authenticated users to delete their own reactions" on public.reactions;
create policy "Allow authenticated users to delete their own reactions" on public.reactions for delete using (auth.uid() = user_id);

alter table public.comments enable row level security;

drop policy if exists "Allow all users to read comments" on public.comments;
create policy "Allow all users to read comments" on public.comments for select using (true);

drop policy if exists "Allow authenticated users to insert their own comments" on public.comments;
create policy "Allow authenticated users to insert their own comments" on public.comments for insert with check (auth.uid() = user_id);

drop policy if exists "Allow users to update their own comments" on public.comments;
create policy "Allow users to update their own comments" on public.comments for update using (auth.uid() = user_id);

drop policy if exists "Allow users to delete their own comments" on public.comments;
create policy "Allow users to delete their own comments" on public.comments for delete using (auth.uid() = user_id);

alter table public.notices enable row level security;

drop policy if exists "Allow all users to read notices" on public.notices;
create policy "Allow all users to read notices" on public.notices for select using (true);
```

_Gemini는 위의 가이드라인을 기반으로 작업을 수행해야 하며, 프로젝트의 기존 흐름을 벗어나지 않도록 주의해야 합니다._
